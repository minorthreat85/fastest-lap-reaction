<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fastest Lap | Reaction Challenge</title>

  <style>
    :root{
      /* Fastest Lap palette */
      --bg0:#000;
      --bg1:#070707;
      --panel:#0f0f10;
      --panel2:#141416;
      --stroke:rgba(255,255,255,.10);
      --stroke2:rgba(255,255,255,.06);
      --text:#f2f2f2;
      --muted:#a9a9a9;
      --red:#e10600;           /* Fastest Lap red */
      --green:#21e26b;         /* go light */
      --amber:#ffb020;         /* warning */
      --shadow:0 18px 50px rgba(0,0,0,.55);
      --radius:22px;
      --font: system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 50% 0%, rgba(225,6,0,.18), transparent 60%),
        radial-gradient(900px 600px at 20% 40%, rgba(255,255,255,.05), transparent 55%),
        linear-gradient(180deg,var(--bg1),var(--bg0));
    }

    .wrap{
      min-height:100%;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:24px;
    }

    .shell{
      width:min(980px,100%);
      border-radius:var(--radius);
      background: rgba(255,255,255,.03);
      border:1px solid var(--stroke2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    /* ===== Top bar ===== */
    .top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:18px 20px;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-bottom:1px solid var(--stroke2);
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:220px;
    }
    .brand img{
      width:44px;height:44px;border-radius:12px;
      background: rgba(255,255,255,.04);
      border:1px solid var(--stroke2);
      padding:6px;
      filter: drop-shadow(0 8px 18px rgba(0,0,0,.6));
    }
    .brandText{
      display:flex;
      flex-direction:column;
      line-height:1.05;
    }
    .brandText .name{
      font-weight:900;
      letter-spacing:.08em;
      text-transform:uppercase;
      font-size:14px;
    }
    .brandText .sub{
      color:var(--muted);
      font-size:12px;
      letter-spacing:.06em;
      margin-top:4px;
    }

    .meta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .chip{
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--stroke2);
      background: rgba(0,0,0,.25);
      color:var(--muted);
      font-size:12px;
      letter-spacing:.06em;
      display:flex;
      gap:8px;
      align-items:center;
      user-select:none;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;
      background: var(--red);
      box-shadow: 0 0 0 3px rgba(225,6,0,.16);
    }

    /* ===== Body layout ===== */
    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
      padding:16px;
    }
    @media (max-width: 860px){
      .grid{grid-template-columns:1fr}
    }

    .left, .right{
      background: rgba(0,0,0,.25);
      border:1px solid var(--stroke2);
      border-radius:18px;
      padding:16px;
    }

    /* ===== Left: game surface ===== */
    .headline{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:12px;
      padding:4px 2px 14px;
    }
    .headline h1{
      margin:0;
      font-size:20px;
      letter-spacing:.06em;
      text-transform:uppercase;
    }
    .headline .hintSmall{
      color:var(--muted);
      font-size:12px;
      letter-spacing:.06em;
      text-align:right;
    }

    .stage{
      border-radius:18px;
      border:1px solid var(--stroke2);
      background:
        radial-gradient(700px 300px at 50% 0%, rgba(225,6,0,.10), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      padding:16px;
    }

    .status{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:12px 12px;
      border-radius:14px;
      background: rgba(0,0,0,.25);
      border:1px solid var(--stroke2);
      margin-bottom:14px;
    }
    .status .msg{
      font-weight:900;
      letter-spacing:.04em;
    }
    .status .msg .green{color:var(--green)}
    .status .msg .red{color:var(--red)}
    .status .msg .amber{color:var(--amber)}
    .status .rt{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      color: var(--muted);
      font-size:12px;
      letter-spacing:.08em;
      text-transform:uppercase;
      white-space:nowrap;
    }

    .lights{
      display:flex;
      justify-content:center;
      gap:18px;
      padding:12px 10px 18px;
      user-select:none;
    }
    .light{
      width:54px;height:54px;border-radius:999px;
      background:#242424;
      border:1px solid rgba(255,255,255,.10);
      position:relative;
      box-shadow: inset 0 0 0 6px rgba(0,0,0,.35);
    }
    .light::after{
      content:"";
      position:absolute; inset:10px 12px auto 12px;
      height:16px; border-radius:999px;
      background: rgba(255,255,255,.08);
      transform: rotate(-18deg);
      filter: blur(.2px);
      opacity:.8;
    }

    .tapZone{
      display:flex;
      justify-content:center;
      margin-top:6px;
    }
    .tapBtn{
      width:min(540px,100%);
      padding:16px 18px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.25);
      color: var(--text);
      cursor:pointer;
      font-weight:1000;
      letter-spacing:.10em;
      text-transform:uppercase;
      position:relative;
      overflow:hidden;
    }
    .tapBtn .accent{
      color: var(--red);
    }
    .tapBtn:active{transform: translateY(1px)}
    .tapBtn::before{
      content:"";
      position:absolute; inset:0;
      background: linear-gradient(90deg, transparent, rgba(225,6,0,.18), transparent);
      transform: translateX(-60%);
    }
    .tapBtn:hover::before{
      animation: sweep 1.2s ease-in-out infinite;
    }
    @keyframes sweep{
      0%{transform:translateX(-60%)}
      100%{transform:translateX(60%)}
    }

    .controls{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-top:14px;
      justify-content:center;
    }
    .btn{
      padding:12px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      cursor:pointer;
      font-weight:1000;
      letter-spacing:.08em;
      text-transform:uppercase;
      background: rgba(255,255,255,.06);
      color: var(--text);
      min-width: 180px;
    }
    .btnPrimary{
      background: var(--red);
      border-color: rgba(255,255,255,.16);
    }
    .btn:active{transform: translateY(1px)}

    /* ===== Right: driver + stats ===== */
    .panelTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:12px;
    }
    .panelTitle h2{
      margin:0;
      font-size:14px;
      letter-spacing:.10em;
      text-transform:uppercase;
      color: var(--muted);
    }

    .field{
      display:flex;
      gap:10px;
      margin-bottom:12px;
    }
    .field input{
      width:100%;
      padding:14px 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      color: var(--text);
      font-size:16px;
      outline:none;
      text-align:left;
    }
    .field input::placeholder{color:#7a7a7a}

    .cards{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
    }
    .statCard{
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.25);
      padding:12px 12px;
      position:relative;
      overflow:hidden;
    }
    .statCard .stripe{
      position:absolute; left:0; top:0; bottom:0; width:4px;
      background: var(--red);
      opacity:.95;
    }
    .statCard .row{
      display:flex;
      align-items:baseline;
      justify-content:space-between;
      gap:12px;
    }
    .statCard .k{
      color:var(--muted);
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
    }
    .statCard .v{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size:22px;
      font-weight:900;
      letter-spacing:.02em;
    }
    .proBadge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      margin-top:10px;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(225,6,0,.12);
      color: var(--text);
      font-weight:900;
      letter-spacing:.06em;
      text-transform:uppercase;
      font-size:12px;
      user-select:none;
    }
    .proBadge .tiny{
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      opacity:.95;
    }

    .footerNote{
      margin-top:14px;
      color: var(--muted);
      font-size:12px;
      letter-spacing:.04em;
      line-height:1.35;
    }
    .kbd{
      display:inline-block;
      padding:2px 8px;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size:12px;
      margin:0 4px;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="shell">

      <div class="top">
        <div class="brand">
          <img src="icon-512.png" alt="Fastest Lap" />
          <div class="brandText">
            <div class="name">Fastest Lap</div>
            <div class="sub">Reaction Challenge</div>
          </div>
        </div>

        <div class="meta">
          <div class="chip"><span class="dot"></span> Live</div>
          <div class="chip">Tap zone or press <span class="kbd">Space</span></div>
        </div>
      </div>

      <div class="grid">

        <!-- LEFT: Game -->
        <div class="left">
          <div class="headline">
            <h1>Start Lights</h1>
            <div class="hintSmall">Tap when lights turn <span style="color:var(--green);font-weight:900;">GREEN</span></div>
          </div>

          <div class="stage">
            <div class="status">
              <div class="msg" id="statusMsg">
                Press <span class="amber">START</span> to begin.
              </div>
              <div class="rt" id="statusRt">
                PRO: <span id="proInline">0.250s</span>
              </div>
            </div>

            <div class="lights" id="lightsRow" aria-label="Start lights">
              <div class="light" id="light1"></div>
              <div class="light" id="light2"></div>
              <div class="light" id="light3"></div>
              <div class="light" id="light4"></div>
            </div>

            <div class="tapZone">
              <button class="tapBtn" id="tapBtn" type="button">
                TAP TO REACT <span class="accent">▸</span>
              </button>
            </div>

            <div class="controls">
              <button class="btn btnPrimary" id="startBtn" type="button">START</button>
              <button class="btn" id="resetBtn" type="button">RESET STATS</button>
            </div>
          </div>
        </div>

        <!-- RIGHT: Stats -->
        <div class="right">
          <div class="panelTitle">
            <h2>Driver</h2>
          </div>

          <div class="field">
            <input id="nameInput" type="text" placeholder="Enter driver name (optional)" maxlength="24" />
          </div>

          <div class="panelTitle" style="margin-top:8px;">
            <h2>Stats</h2>
          </div>

          <div class="cards">
            <div class="statCard">
              <div class="stripe"></div>
              <div class="row">
                <div class="k">Last run</div>
                <div class="v" id="lastRunTxt">0.000s</div>
              </div>
            </div>
            <div class="statCard">
              <div class="stripe"></div>
              <div class="row">
                <div class="k">Avg 10 runs</div>
                <div class="v" id="avgRunTxt">0.000s</div>
              </div>
            </div>
            <div class="statCard">
              <div class="stripe"></div>
              <div class="row">
                <div class="k">Fastest run</div>
                <div class="v" id="bestRunTxt">0.000s</div>
              </div>
            </div>
          </div>

          <div class="proBadge" title="Target time">
            PRO TIME <span class="tiny" id="proRunTxt">0.250s</span>
          </div>

          <div class="footerNote">
            Tips: Tap the button or press <span class="kbd">Space</span> to react.
            Early tap = false start.
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // ===== Settings =====
    const PRO_MS = 250;
    const MIN_DELAY_MS = 2000;
    const MAX_DELAY_MS = 5000;
    const RUNS_FOR_AVG = 10;

    // ===== State =====
    let state = "idle"; // idle | armed | go | done
    let goTime = 0;
    let timeoutId = null;
    let bestMs = null;
    let lastRuns = [];

    // ===== Elements =====
    const nameInput  = document.getElementById("nameInput");
    const startBtn   = document.getElementById("startBtn");
    const resetBtn   = document.getElementById("resetBtn");
    const tapBtn     = document.getElementById("tapBtn");

    const statusMsg  = document.getElementById("statusMsg");
    const statusRt   = document.getElementById("statusRt");

    const lastRunTxt = document.getElementById("lastRunTxt");
    const avgRunTxt  = document.getElementById("avgRunTxt");
    const bestRunTxt = document.getElementById("bestRunTxt");

    const proRunTxt  = document.getElementById("proRunTxt");
    const proInline  = document.getElementById("proInline");

    const lights = [
      document.getElementById("light1"),
      document.getElementById("light2"),
      document.getElementById("light3"),
      document.getElementById("light4"),
    ];

    // ===== Helpers =====
    function clearTimers(){
      if (timeoutId){
        clearTimeout(timeoutId);
        timeoutId = null;
      }
    }
    function setLights(color){
      lights.forEach(l => l.style.background = color);
    }
    function formatMs(ms){
      return (ms / 1000).toFixed(3) + "s";
    }
    function avgOf(arr){
      if (!arr.length) return 0;
      return arr.reduce((a,b)=>a+b,0) / arr.length;
    }
    function setStatus(html, rightText){
      statusMsg.innerHTML = html;
      if (rightText) statusRt.innerHTML = rightText;
    }
    function updateStats(lastMs){
      proRunTxt.textContent = formatMs(PRO_MS);
      proInline.textContent = formatMs(PRO_MS);

      if (lastMs == null){
        lastRunTxt.textContent = "0.000s";
        avgRunTxt.textContent  = "0.000s";
        bestRunTxt.textContent = "0.000s";
        return;
      }

      lastRunTxt.textContent = formatMs(lastMs);

      bestMs = (bestMs == null) ? lastMs : Math.min(bestMs, lastMs);
      bestRunTxt.textContent = formatMs(bestMs);

      lastRuns.unshift(lastMs);
      lastRuns = lastRuns.slice(0, RUNS_FOR_AVG);
      avgRunTxt.textContent = formatMs(avgOf(lastRuns));
    }

    function resetStats(){
      bestMs = null;
      lastRuns = [];
      updateStats(null);
      setStatus('Press <span class="amber">START</span> to begin.', `PRO: <span>${formatMs(PRO_MS)}</span>`);
      setLights("#242424");
      state = "idle";
      clearTimers();
    }

    // ===== Game Flow =====
    function armGame(){
      clearTimers();
      state = "armed";
      setLights(getComputedStyle(document.documentElement).getPropertyValue("--red").trim() || "#e10600");
      setStatus('Hold… wait for <span class="green">GREEN</span>.', `ARMED • PRO: <span>${formatMs(PRO_MS)}</span>`);

      const delay = MIN_DELAY_MS + Math.floor(Math.random() * (MAX_DELAY_MS - MIN_DELAY_MS + 1));
      timeoutId = setTimeout(() => {
        state = "go";
        setLights(getComputedStyle(document.documentElement).getPropertyValue("--green").trim() || "#21e26b");
        goTime = Date.now();
        setStatus('<span class="green">GO!</span> Tap now.', `LIVE • PRO: <span>${formatMs(PRO_MS)}</span>`);
      }, delay);
    }

    function registerReaction(){
      if (state === "idle") return;

      if (state === "armed"){
        clearTimers();
        state = "done";
        setLights(getComputedStyle(document.documentElement).getPropertyValue("--red").trim() || "#e10600");
        setStatus('❌ <span class="red">False start.</span> Press <span class="amber">START</span> to try again.', `RESET • PRO: <span>${formatMs(PRO_MS)}</span>`);
        return;
      }

      if (state === "go"){
        const rt = Date.now() - goTime;
        state = "done";
        setLights("#242424");

        const name = (nameInput.value || "").trim();
        const beat = rt <= PRO_MS;
        const badge = beat ? ` ✅ Beat PRO` : ``;

        setStatus(
          `Reaction: <span class="amber">${formatMs(rt)}</span>${name ? ` — <span class="red">${name}</span>` : ""}${badge}<br/>Press <span class="amber">START</span> to run again.`,
          `DONE • PRO: <span>${formatMs(PRO_MS)}</span>`
        );

        updateStats(rt);
      }
    }

    // ===== Events =====
    startBtn.addEventListener("click", armGame);
    resetBtn.addEventListener("click", resetStats);
    tapBtn.addEventListener("click", registerReaction);

    tapBtn.addEventListener("touchstart", (e) => {
      e.preventDefault();
      registerReaction();
    }, { passive:false });

    window.addEventListener("keydown", (e) => {
      if (e.code === "Space"){
        e.preventDefault();
        if (state === "idle") armGame();
        else registerReaction();
      }
    });

    // Init
    resetStats();
  </script>
</body>
</html>
